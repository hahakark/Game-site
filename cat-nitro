<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GameHub ‚Äî Play in-browser</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üéÆ</text></svg>">
<style>
  :root{
    --bg:#081223; --panel:#0b1624; --muted:#9fb1c6; --accent:#60a5fa;
    --glass: rgba(255,255,255,0.03);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; background:linear-gradient(180deg,#031021 0%, #071426 100%); color:#eaf6ff; -webkit-font-smoothing:antialiased}
  .wrap{display:grid; grid-template-columns:300px 1fr 320px; gap:16px; padding:18px; height:100vh}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:14px; border:1px solid rgba(255,255,255,0.03); overflow:auto}
  header.site{display:flex; gap:12px; align-items:center}
  .logo{display:flex; gap:10px; align-items:center}
  .icon{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-size:20px}
  .title{font-weight:700}
  .search input{width:100%;padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:inherit}
  /* main player area */
  .player{background:var(--panel); border-radius:12px; padding:12px; min-height:420px; display:flex; flex-direction:column; gap:12px; border:1px solid rgba(255,255,255,0.02)}
  .player-top{display:flex; align-items:center; justify-content:space-between}
  .viewport{flex:1; background:#000; border-radius:10px; overflow:hidden; min-height:300px; position:relative; display:flex; align-items:center; justify-content:center}
  .viewport iframe{width:100%; height:100%; border:0; display:block}
  .controls{display:flex; gap:8px; align-items:center}
  .chip{padding:8px 10px;border-radius:9px;background:var(--glass); border:1px solid rgba(255,255,255,0.02); cursor:pointer}
  /* games grid */
  .games{display:grid; grid-template-columns: repeat(auto-fill,minmax(160px,1fr)); gap:12px}
  .game{display:flex; gap:10px; align-items:center; padding:10px; border-radius:10px; cursor:pointer; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.02); transition:transform .12s}
  .game:hover{transform:translateY(-6px)}
  .thumb{width:56px;height:42px;border-radius:8px;background:linear-gradient(180deg,#071026,#0b121a);display:flex;align-items:center;justify-content:center;color:var(--muted)}
  .meta .name{font-weight:700}
  .meta .sub{font-size:0.86rem;color:var(--muted)}
  /* right column: recent + settings */
  .right{display:flex; flex-direction:column; gap:12px}
  .recent-item{display:flex; justify-content:space-between; gap:10px; align-items:center; padding:8px; border-radius:8px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02))}
  .small{font-size:0.86rem;color:var(--muted)}
  /* modal overlay */
  .overlay{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:60}
  .overlay.show{display:flex}
  .modal{width:560px;background:linear-gradient(180deg,#071327,#051026); border-radius:12px; padding:16px; border:1px solid rgba(255,255,255,0.04)}
  /* responsive */
  @media (max-width:1000px){
    .wrap{grid-template-columns:1fr; grid-auto-rows:min-content; padding:12px}
    .right{order:3}
  }
</style>
</head>
<body>
<div class="wrap" role="application" aria-label="GameHub">
  <!-- left column -->
  <aside class="panel" aria-label="Left controls">
    <header class="site">
      <div class="logo">
        <div class="icon">üéÆ</div>
        <div>
          <div class="title">GameHub</div>
          <div class="small">Play-in-browser</div>
        </div>
      </div>
      <button class="chip" id="openSettings" title="Settings">‚öôÔ∏è</button>
    </header>

    <hr style="opacity:.06;margin:12px 0">

    <div>
      <label class="small">Search</label>
      <div class="search" style="margin-top:8px"><input id="search" placeholder="Search games or tags..."></div>
    </div>

    <div style="margin-top:12px">
      <div class="small">Presets</div>
      <div style="display:flex;flex-wrap:wrap; gap:8px; margin-top:8px">
        <button class="chip preset" data-url="https://play2048.co/">2048</button>
        <button class="chip preset" data-url="https://chromedino.com/">Dino</button>
        <button class="chip preset" data-url="https://tetris.com/play-tetris">Tetris</button>
      </div>
    </div>

    <hr style="opacity:.06;margin:12px 0">

    <div>
      <div class="small">Music (mp3/ogg)</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="musicUrl" placeholder="Paste direct audio URL" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:inherit">
        <button id="loadMusic" class="chip">Load</button>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="playMusic" class="chip">Play</button>
        <button id="pauseMusic" class="chip">Pause</button>
      </div>
      <div id="musicStatus" class="small" style="margin-top:8px">No track loaded.</div>
    </div>

  </aside>

  <!-- center: player + games -->
  <main style="display:flex; flex-direction:column; gap:12px">
    <section class="player" aria-label="Player">
      <div class="player-top">
        <div>
          <div style="font-weight:800">Web Player</div>
          <div class="small">Click a tile to load ‚Äî some pages block embedding, use "Open externally" if that happens.</div>
        </div>
        <div class="controls">
          <button id="openInNew" class="chip">Open externally</button>
          <button id="closeGame" class="chip">Close</button>
        </div>
      </div>

      <div class="viewport" id="viewport">
        <div id="emptyNotice" class="small" style="padding:18px;text-align:center;color:var(--muted)">Select a game to start playing.</div>
      </div>
    </section>

    <section class="panel" aria-label="Game collection">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:800">Games</div>
        <div class="small">A sample collection ‚Äî add/remove as you like</div>
      </div>

      <div style="margin-top:12px" id="gamesGrid" class="games" role="list"></div>
    </section>
  </main>

  <!-- right column -->
  <aside class="panel right" aria-label="Right column">
    <div>
      <div style="font-weight:700">Recently played</div>
      <div id="recentList" style="margin-top:8px;display:flex;flex-direction:column;gap:8px"></div>
    </div>

    <div>
      <div style="font-weight:700">Quick actions</div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <button id="clearRecent" class="chip">Clear recently played</button>
        <button id="toggleDark" class="chip">Toggle theme</button>
      </div>
    </div>

    <div style="margin-top:auto" class="small">Tip: some external sites block iframe embedding ‚Äî use Open externally to play in a new tab.</div>
  </aside>
</div>

<!-- modal -->
<div class="overlay" id="overlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:800">Settings</div>
        <div class="small">Customize quick options</div>
      </div>
      <button id="closeModal" class="chip">Close</button>
    </div>

    <hr style="opacity:.06;margin:12px 0">

    <div>
      <label class="small">Tab title (cloaker)</label>
      <input id="tabTitle" placeholder="Example: News ‚Äî Times" style="width:100%;padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:inherit;margin-top:8px">
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="applyTitle" class="chip">Apply</button>
        <button id="resetTitle" class="chip">Reset</button>
      </div>
    </div>
  </div>
</div>

<script>
  // --- sample games collection (change or extend freely) ---
  const games = [
    {name:'2048', url:'https://play2048.co/', desc:'Tile merge puzzle'},
    {name:'Chrome Dino', url:'https://chromedino.com/', desc:'Offline runner'},
    {name:'Tetris', url:'https://tetris.com/play-tetris', desc:'Official Tetris'},
    {name:'Snake', url:'https://playsnake.org/', desc:'Classic Snake'},
    {name:'Hextris', url:'https://hextris.github.io/', desc:'Reflex puzzle'},
    {name:'A Dark Room', url:'https://adarkroom.doublespeakgames.com/', desc:'Text survival'},
    {name:'Cookie Clicker', url:'https://orteil.dashnet.org/cookieclicker/', desc:'Incremental' },
    {name:'Minecraft Classic', url:'https://classic.minecraft.net/', desc:'Classic Creative' },
    {name:'Pacman', url:'https://www.retrogames.cz/play_012-Atari2600.php?language=EN', desc:'Arcade' }
  ];

  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  // populate grid
  function renderGrid(filter=''){
    const grid = $('#gamesGrid');
    grid.innerHTML = '';
    const q = (filter||'').toLowerCase().trim();
    const items = games.filter(g => g.name.toLowerCase().includes(q) || (g.desc || '').toLowerCase().includes(q));
    if(items.length === 0){
      grid.innerHTML = '<div class="small" style="padding:8px">No games found.</div>';
      return;
    }
    items.forEach(g=>{
      const el = document.createElement('div');
      el.className = 'game';
      el.tabIndex = 0;
      el.innerHTML = `<div class="thumb">üéÆ</div>
        <div class="meta">
          <div class="name">${escapeHtml(g.name)}</div>
          <div class="sub">${escapeHtml(g.desc||'')}</div>
        </div>`;
      el.addEventListener('click', ()=> loadGame(g));
      el.addEventListener('keypress', e=> { if(e.key === 'Enter') loadGame(g) });
      grid.appendChild(el);
    });
  }

  function escapeHtml(str){ return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[s]) }

  // player
  const viewport = $('#viewport');
  let currentGame = null;

  function loadGame(g){
    currentGame = g;
    // remove empty notice
    const empty = $('#emptyNotice');
    if(empty) empty.remove();

    // create iframe
    const iframe = document.createElement('iframe');
    iframe.src = g.url;
    iframe.title = g.name;
    iframe.allow = "fullscreen; autoplay; encrypted-media; picture-in-picture";
    iframe.style.background = '#000';
    // clear
    viewport.innerHTML = '';
    viewport.appendChild(iframe);
    addRecent(g);
    $('#openInNew').dataset.url = g.url;
    document.title = g.name + ' ‚Äî GameHub';
    // add "open externally" button on top-right if embed blocked (fallback)
    setTimeout(()=> addExternalOverlay(iframe), 600);
  }

  function addExternalOverlay(iframe){
    // if site blocks embedding, browser may still render a blocked frame or show static text;
    // provide a visible "Open externally" fallback button
    if(!viewport.querySelector('.externalBtn')){
      const btn = document.createElement('button');
      btn.className = 'chip externalBtn';
      btn.textContent = 'Open externally';
      btn.style.position = 'absolute';
      btn.style.right = '18px';
      btn.style.top = '18px';
      btn.addEventListener('click', ()=> {
        window.open(iframe.src, '_blank','noopener');
      });
      viewport.appendChild(btn);
    }
  }

  function closeGame(){
    currentGame = null;
    viewport.innerHTML = '<div id="emptyNotice" class="small" style="padding:18px;text-align:center;color:var(--muted)">Select a game to start playing.</div>';
    $('#openInNew').removeAttribute('data-url');
    document.title = 'GameHub ‚Äî Play in-browser';
  }

  // recently played (localStorage)
  function addRecent(g){
    const list = JSON.parse(localStorage.getItem('gh_recent')||'[]');
    const now = Date.now();
    const filtered = list.filter(x => x.url !== g.url);
    filtered.unshift({name:g.name, url:g.url, ts:now});
    if(filtered.length > 10) filtered.splice(10);
    localStorage.setItem('gh_recent', JSON.stringify(filtered));
    renderRecent();
  }

  function renderRecent(){
    const container = $('#recentList');
    const arr = JSON.parse(localStorage.getItem('gh_recent')||'[]');
    container.innerHTML = '';
    if(arr.length === 0){ container.innerHTML = '<div class="small">No recently played.</div>'; return; }
    arr.forEach(item=>{
      const el = document.createElement('div');
      el.className = 'recent-item';
      el.innerHTML = `<div style="display:flex;gap:10px;align-items:center">
          <div class="thumb" style="width:36px;height:28px;border-radius:6px">üîπ</div>
          <div style="min-width:0">
            <div style="font-weight:700">${escapeHtml(item.name)}</div>
            <div class="small">${new Date(item.ts).toLocaleString()}</div>
          </div>
        </div>
        <div style="display:flex;gap:8px">
          <button class="chip playRecent" data-url="${escapeHtml(item.url)}">Play</button>
        </div>`;
      container.appendChild(el);
    });
    container.querySelectorAll('.playRecent').forEach(btn=>{
      btn.addEventListener('click', ()=> {
        const url = btn.dataset.url;
        const g = games.find(x=>x.url === url) || {name:'External', url};
        loadGame(g);
      });
    });
  }

  // search
  $('#search').addEventListener('input', e => renderGrid(e.target.value));

  // presets
  $$('.preset').forEach(b => b.addEventListener('click', ()=> {
    const url = b.dataset.url;
    const name = b.textContent;
    loadGame({name, url, desc:'Preset'});
  }));

  // open externally
  $('#openInNew').addEventListener('click', ()=> {
    const url = $('#openInNew').dataset.url;
    if(url) window.open(url, '_blank','noopener');
  });

  $('#closeGame').addEventListener('click', closeGame);

  // modal settings
  $('#openSettings').addEventListener('click', ()=> {
    $('#overlay').classList.add('show'); $('#overlay').setAttribute('aria-hidden','false');
  });
  $('#closeModal').addEventListener('click', ()=> {
    $('#overlay').classList.remove('show'); $('#overlay').setAttribute('aria-hidden','true');
  });
  window.addEventListener('keydown', e => {
    if(e.key === 'Escape'){ $('#overlay').classList.remove('show'); $('#overlay').setAttribute('aria-hidden','true'); }
  });

  // tab title cloaker
  $('#applyTitle').addEventListener('click', ()=> {
    const t = $('#tabTitle').value.trim();
    if(t) document.title = t;
  });
  $('#resetTitle').addEventListener('click', ()=> document.title = 'GameHub ‚Äî Play in-browser');

  // music player
  const audio = new Audio();
  audio.loop = true;
  $('#loadMusic').addEventListener('click', ()=> {
    const u = $('#musicUrl').value.trim();
    if(!u){ $('#musicStatus').textContent = 'Paste a direct mp3/ogg URL.'; return; }
    audio.src = u;
    $('#musicStatus').textContent = 'Loaded: ' + u;
  });
  $('#playMusic').addEventListener('click', ()=> {
    audio.play().then(()=> $('#musicStatus').textContent = 'Playing').catch(()=> $('#musicStatus').textContent = 'Play blocked ‚Äî user interaction required.');
  });
  $('#pauseMusic').addEventListener('click', ()=> { audio.pause(); $('#musicStatus').textContent = 'Paused'; });

  // clear recent
  $('#clearRecent').addEventListener('click', ()=> {
    localStorage.removeItem('gh_recent'); renderRecent();
  });

  // toggle theme (simple invert)
  let dark = true;
  $('#toggleDark').addEventListener('click', ()=> {
    dark = !dark;
    if(!dark){
      document.documentElement.style.setProperty('--bg', '#f6f8fb');
      document.documentElement.style.setProperty('--panel', '#ffffff');
      document.documentElement.style.setProperty('--muted', '#4b5563');
      document.body.style.color = '#0b1220';
      document.body.style.background = 'linear-gradient(180deg,#f8fbff,#eaf3ff)';
    } else {
      document.documentElement.style.removeProperty('--bg'); document.documentElement.style.removeProperty('--panel');
      document.documentElement.style.removeProperty('--muted');
      document.body.style.color = '';
      document.body.style.background = '';
    }
  });

  // fallback overlay for blocked iframes: watch for child additions
  const observer = new MutationObserver(()=> {
    const iframe = viewport.querySelector('iframe');
    if(!iframe) return;
    // if page restricts framing, keep "Open externally" visible (already provided)
    // add a simple checker (if iframe contentWindow is null, it might be blocked)
    // Can't reliably inspect cross-origin, so just ensure externalBtn exists
    if(!viewport.querySelector('.externalBtn')){
      const btn = document.createElement('button');
      btn.className = 'chip externalBtn';
      btn.textContent = 'Open externally';
      btn.style.position = 'absolute';
      btn.style.right = '18px';
      btn.style.top = '18px';
      btn.addEventListener('click', ()=> window.open(iframe.src, '_blank','noopener'));
      viewport.appendChild(btn);
    }
  });
  observer.observe(viewport, {childList:true, subtree:true});

  // initial render
  renderGrid();
  renderRecent();

  // expose console helper
  window.loadGameByUrl = (url, name='External') => loadGame({name, url, desc:'External'});

</script>
</body>
</html>
